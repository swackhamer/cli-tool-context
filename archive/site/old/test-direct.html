<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Direct DataLoader Test</title>
</head>
<body>
    <h1>Direct DataLoader Test</h1>
    <pre id="output"></pre>
    
    <!-- Load dependencies in order -->
    <script src="js/browser-compatibility.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/data-normalizer.js"></script>
    <script src="js/data-loader.js"></script>
    <script src="js/data-validator.js"></script>
    <script src="js/simple-error-handler.js"></script>
    
    <script>
        const output = document.getElementById('output');
        const log = [];
        
        const addLog = (msg) => {
            log.push(msg);
            output.textContent = log.join('\n');
            console.log(msg);
        };
        
        async function testDirectLoad() {
            addLog('Starting direct DataLoader test...\n');
            
            // Check modules
            addLog(`DataLoader available: ${typeof window.DataLoader !== 'undefined'}`);
            addLog(`SimpleErrorHandler available: ${typeof window.simpleErrorHandler !== 'undefined'}\n`);
            
            if (typeof window.DataLoader === 'undefined') {
                addLog('ERROR: DataLoader not available!');
                return;
            }
            
            try {
                // Create DataLoader instance like main.js does
                const dataLoader = new window.DataLoader({
                    validateDuringLoad: true,
                    maxRetries: 1
                });
                
                addLog('DataLoader instance created');
                addLog('Calling dataLoader.loadAll()...\n');
                
                // Try to load data
                const loadedData = await dataLoader.loadAll();
                
                addLog('SUCCESS! Data loaded:');
                addLog(`- Tools: ${loadedData.tools ? loadedData.tools.length : 'none'}`);
                addLog(`- Categories: ${loadedData.categories ? loadedData.categories.length : 'none'}`);
                addLog(`- Stats: ${loadedData.stats ? 'present' : 'missing'}`);
                
                if (loadedData.tools && loadedData.tools.length > 0) {
                    addLog(`\nFirst tool: ${loadedData.tools[0].name || loadedData.tools[0].id}`);
                }
                
            } catch (error) {
                addLog(`\nERROR: ${error.message}`);
                addLog(`Stack: ${error.stack}`);
                
                // Try direct fetch as fallback
                addLog('\n--- Trying direct fetch ---');
                try {
                    const response = await fetch('data/tools.json');
                    addLog(`Fetch status: ${response.status}`);
                    if (response.ok) {
                        const data = await response.json();
                        addLog(`Direct fetch SUCCESS: ${data.tools ? data.tools.length + ' tools' : 'no tools'}`);
                    }
                } catch (fetchError) {
                    addLog(`Direct fetch failed: ${fetchError.message}`);
                }
            }
        }
        
        // Run test when page loads
        window.addEventListener('DOMContentLoaded', testDirectLoad);
    </script>
</body>
</html>