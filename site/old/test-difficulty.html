<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Difficulty Filter</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { margin: 10px; padding: 5px 10px; }
    </style>
</head>
<body>
    <h1>Difficulty Filter Test</h1>
    
    <div>
        <button onclick="testDifficulty(1)">Test Difficulty 1 (Beginner)</button>
        <button onclick="testDifficulty(2)">Test Difficulty 2 (Basic)</button>
        <button onclick="testDifficulty(3)">Test Difficulty 3 (Intermediate)</button>
        <button onclick="testDifficulty(4)">Test Difficulty 4 (Advanced)</button>
        <button onclick="testDifficulty(5)">Test Difficulty 5 (Expert)</button>
    </div>
    
    <div id="output"></div>
    
    <script src="js/performance-optimizer.js"></script>
    <script>
        const output = document.getElementById('output');
        let filterIndex;
        let tools = [];
        
        async function init() {
            output.innerHTML = '<div class="info">Loading tools data...</div>';
            
            try {
                // Load tools
                const response = await fetch('data/tools.json');
                const data = await response.json();
                tools = data.tools || [];
                
                output.innerHTML += `<div class="success">Loaded ${tools.length} tools</div>`;
                
                // Count tools by difficulty
                const difficultyCounts = {};
                tools.forEach(tool => {
                    const diff = tool.difficulty || 0;
                    difficultyCounts[diff] = (difficultyCounts[diff] || 0) + 1;
                });
                
                output.innerHTML += '<div class="info">Tools by difficulty:</div>';
                for (let i = 0; i <= 5; i++) {
                    output.innerHTML += `<div>  Difficulty ${i}: ${difficultyCounts[i] || 0} tools</div>`;
                }
                
                // Build filter index
                filterIndex = new window.PerformanceOptimizer.FilterIndex();
                filterIndex.buildIndexes(tools);
                output.innerHTML += '<div class="success">Filter index built</div>';
                
            } catch (error) {
                output.innerHTML += `<div class="error">Error: ${error.message}</div>`;
            }
        }
        
        function testDifficulty(difficulty) {
            if (!filterIndex) {
                output.innerHTML += '<div class="error">Filter index not initialized</div>';
                return;
            }
            
            output.innerHTML += `<hr><div class="info">Testing difficulty ${difficulty}...</div>`;
            
            // Get tools with this difficulty using the index
            const toolIndexes = filterIndex.getByDifficulty(difficulty, difficulty);
            output.innerHTML += `<div>Filter index returned ${toolIndexes.size} tools</div>`;
            
            // Verify by checking manually
            let manualCount = 0;
            tools.forEach(tool => {
                if (tool.difficulty === difficulty) {
                    manualCount++;
                }
            });
            output.innerHTML += `<div>Manual count: ${manualCount} tools</div>`;
            
            // Show first 5 tools
            if (toolIndexes.size > 0) {
                output.innerHTML += '<div>First 5 tools:</div>';
                let count = 0;
                for (const index of toolIndexes) {
                    if (count >= 5) break;
                    const tool = tools[index];
                    output.innerHTML += `<div>  - ${tool.name} (difficulty: ${tool.difficulty})</div>`;
                    count++;
                }
            }
            
            // Check if counts match
            if (toolIndexes.size === manualCount) {
                output.innerHTML += '<div class="success">✓ Filter working correctly!</div>';
            } else {
                output.innerHTML += '<div class="error">✗ Mismatch in counts!</div>';
            }
        }
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>