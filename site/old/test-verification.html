<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Verification - CLI Tool Context</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .test-status {
            margin: 10px 0;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 5px;
        }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196f3; }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
    </style>
</head>
<body>
    <h1>CLI Tool Context - Test Verification</h1>
    
    <div id="test-status" class="test-status">
        <p>This page verifies the implementation of:</p>
        <ul>
            <li>✅ Comment 1: E2E tests for FilterIndex path parity and synonym handling</li>
            <li>✅ Comment 2: Aria-live region announcements after rendering completes</li>
        </ul>
    </div>

    <div>
        <button onclick="runFilterIndexTests()">Run FilterIndex Tests</button>
        <button onclick="testAriaLiveAnnouncements()">Test Aria-Live Announcements</button>
        <button onclick="location.href='tools.html'">Go to Tools Page</button>
    </div>

    <div id="results" style="margin-top: 20px;"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(entry);
        }

        async function runFilterIndexTests() {
            log('Starting FilterIndex parity tests...', 'info');
            
            // Load the tools page in an iframe to test
            const iframe = document.createElement('iframe');
            iframe.src = 'tools.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = async function() {
                const win = iframe.contentWindow;
                
                // Wait for CLIApp to be ready
                let attempts = 0;
                while ((!win.CLIApp || !win.CLIApp.state) && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (win.CLIApp && win.CLIApp.state) {
                    log('✅ CLIApp loaded successfully', 'success');
                    
                    // Check if FilterIndex tests are available
                    if (win.runIntegrationTests) {
                        log('Running integration tests...', 'info');
                        try {
                            const results = await win.runIntegrationTests();
                            log('Integration tests completed', 'success');
                        } catch (error) {
                            log(`Test error: ${error.message}`, 'error');
                        }
                    } else {
                        log('Integration tests not found', 'warning');
                    }
                } else {
                    log('Failed to load CLIApp', 'error');
                }
                
                document.body.removeChild(iframe);
            };
        }

        async function testAriaLiveAnnouncements() {
            log('Testing aria-live announcements...', 'info');
            
            // Load tools page
            const iframe = document.createElement('iframe');
            iframe.src = 'tools.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = async function() {
                const win = iframe.contentWindow;
                const doc = iframe.contentDocument;
                
                // Wait for initialization
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Check for aria-live region
                const announcement = doc.getElementById('searchResultsAnnouncement');
                if (announcement) {
                    log('✅ Aria-live region found', 'success');
                    
                    // Trigger a filter to test announcements
                    if (win.CLIApp && win.CLIApp.applyFilters) {
                        win.CLIApp.state.filters = { category: 'Development Tools' };
                        await win.CLIApp.applyFilters();
                        
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        if (announcement.textContent) {
                            log(`✅ Announcement updated: "${announcement.textContent}"`, 'success');
                        } else {
                            log('⚠️ Announcement not updated', 'warning');
                        }
                    }
                } else {
                    log('❌ Aria-live region not found', 'error');
                }
                
                document.body.removeChild(iframe);
            };
        }

        // Add console override to capture test output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            
            if (message.includes('✅')) {
                log(message, 'success');
            } else if (message.includes('✓')) {
                log(message, 'success');
            } else {
                log(message, 'info');
            }
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            log(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            log(args.join(' '), 'warning');
        };
    </script>
</body>
</html>