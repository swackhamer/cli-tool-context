<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Loading Order</title>
</head>
<body>
    <h1>Test Loading Order</h1>
    <div id="status">Loading...</div>
    <pre id="log"></pre>
    
    <script>
        const log = [];
        const addLog = (msg) => {
            log.push(`[${new Date().toISOString().split('T')[1]}] ${msg}`);
            document.getElementById('log').textContent = log.join('\n');
        };
        
        // Track script loading
        window.loadedScripts = {};
        
        const loadScript = (src, name) => {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    addLog(`✓ Loaded: ${name}`);
                    window.loadedScripts[name] = true;
                    resolve();
                };
                script.onerror = () => {
                    addLog(`✗ Failed: ${name}`);
                    reject(new Error(`Failed to load ${name}`));
                };
                document.head.appendChild(script);
            });
        };
        
        const testDataFetch = async () => {
            addLog('\n--- Testing Direct Fetch ---');
            try {
                const response = await fetch('data/tools.json');
                addLog(`Fetch tools.json: ${response.ok ? '✓ SUCCESS' : '✗ FAILED'} (${response.status})`);
                
                if (response.ok) {
                    const data = await response.json();
                    addLog(`Tools count: ${data.tools ? data.tools.length : 'No tools array'}`);
                }
            } catch (e) {
                addLog(`Fetch error: ${e.message}`);
            }
        };
        
        const testDataLoader = async () => {
            addLog('\n--- Testing DataLoader ---');
            if (typeof window.DataLoader === 'undefined') {
                addLog('✗ DataLoader not available');
                return;
            }
            
            try {
                const loader = new window.DataLoader();
                addLog('✓ DataLoader instance created');
                
                const data = await loader.loadAll();
                addLog(`✓ Data loaded: ${data.tools ? data.tools.length + ' tools' : 'No tools'}`);
            } catch (e) {
                addLog(`✗ DataLoader error: ${e.message}`);
            }
        };
        
        const runTests = async () => {
            addLog('Starting tests...\n');
            
            // Test direct fetch first
            await testDataFetch();
            
            // Load dependencies in order
            addLog('\n--- Loading Dependencies ---');
            try {
                await loadScript('js/browser-compatibility.js', 'BrowserCompatibility');
                await loadScript('js/performance-optimizer.js', 'PerformanceOptimizer');
                await loadScript('js/data-normalizer.js', 'DataNormalizer');
                await loadScript('js/data-loader.js', 'DataLoader');
                await loadScript('js/data-validator.js', 'DataValidator');
                await loadScript('js/simple-error-handler.js', 'SimpleErrorHandler');
                
                // Test DataLoader
                await testDataLoader();
                
                // Check what's available
                addLog('\n--- Module Availability ---');
                addLog(`window.DataLoader: ${typeof window.DataLoader !== 'undefined' ? '✓' : '✗'}`);
                addLog(`window.DataNormalizer: ${typeof window.DataNormalizer !== 'undefined' ? '✓' : '✗'}`);
                addLog(`window.DataValidator: ${typeof window.DataValidator !== 'undefined' ? '✓' : '✗'}`);
                addLog(`window.SimpleErrorHandler: ${typeof window.SimpleErrorHandler !== 'undefined' ? '✓' : '✗'}`);
                addLog(`window.BrowserCompatibility: ${typeof window.BrowserCompatibility !== 'undefined' ? '✓' : '✗'}`);
                addLog(`window.PerformanceOptimizer: ${typeof window.PerformanceOptimizer !== 'undefined' ? '✓' : '✗'}`);
                
                document.getElementById('status').textContent = 'Tests complete!';
            } catch (e) {
                addLog(`\n✗ Error during loading: ${e.message}`);
                document.getElementById('status').textContent = 'Tests failed!';
            }
        };
        
        // Start tests when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            runTests();
        }
    </script>
</body>
</html>